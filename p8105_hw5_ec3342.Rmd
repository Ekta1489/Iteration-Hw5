---
title: "p8105_hw5_ec3342"
author: "Ekta Chaudhary"
date: "04/11/2019"
output: github_document
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo  = TRUE)
library(tidyverse)
library(rvest)
library(purrr)
library(viridis)
library(broom)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
```
# Question 1

#The code chunk below loads the iris dataset from the tidyverse package and introduces some missing values in each column. The purpose of this problem is to fill in those missing values.

```{r}
library(tidyverse)

set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```
```{r}
rpl_miss = function(x) {
if (is.numeric(x))
  { 
  x = replace_na(x, mean(x, na.rm = TRUE)) #Using a function to replace the missing values of numeric variables with the mean of non-missing values
  }
else if (is.character(x)) {
x = replace_na(x,"virginica")} #Using a function to replace the missing values of character variables, with "virginica"
  }
iris_new = map(iris_with_missing, rpl_miss) %>% 
as_tibble() #Applying the function to the columns of iris_with_missing using a map statement.

```

# Question 2

#Creating a tidy dataframe containing data from all participants, including the subject ID, arm, and observations over time:
#Starting with a dataframe containing all file names using the list.files function.

```{r}

file_name = list.files("./data")

read_csv_files = 
  function(file_name) {
    study_data = read_csv(
      file = str_c("./data/", file_name)
      ) %>%
      mutate(
        file = file_name
      )
  }

#Iterating over file names and reading in data for each subject using map and saving the result as a new variable in the dataframe

study_data = map_df(
  file_name, read_csv_files
) %>%
pivot_longer(
  week_1:week_8, names_to = "week",
  values_to = "measurement"
  ) %>%
  separate(
    file, into = c("group","subject",sep = "-")
    ) %>%
  mutate(
    group = recode(group,"con" = "Control","exp" = "Experimental")
    ) %>%
  select(group,subject,week,measurement)
```


#Making a spaghetti plot showing observations on each subject over time, to find the difference between the two groups.

```{r}
study_data %>%
  ggplot(aes(x = week, y = measurement, group = subject, color = subject)) + 
  geom_point() +
  geom_line() +
  facet_grid(~group) + 
  labs(
    title = "Observation of Subjects over time",
    x = "Week",
    y = "Observation"
  ) + 
  theme(
    legend.position = "bottom"
  ) + viridis::scale_color_viridis(
    name = "Subject ID",
    discrete = TRUE
  )
  
```

#As we can see from the two plots above, in the experimental arm there is an increase in the observation score with time. In the control arm, however the observation score remains somewhat constant. This shows that treatment might be effective as the experimental arm shows an increase in the observation scores with time. However, further analysis should be done to conclude this.

# Question 3

```{r}
set.seed(1)
sim_regression = function(n = 30, beta0 = 2, beta1 = 0) {
  
  sim_data = tibble(
    x = rnorm(n, mean = 0, sd = 1),
    y = beta0 + beta1 * x + rnorm(n, 0, sqrt(50))
  )
  
  ls_fit = lm(y ~ x, data = sim_data)
  
  tibble(
    beta1_hat = as.numeric(broom::tidy(ls_fit)[2,2]),
    p_value = as.numeric(broom::tidy(ls_fit)[2,5]) 
  )
}
```


```{r}
sim_results = tibble(
  beta_1 = c(0,1,2,3,4,5,6)
  ) %>%
  mutate(
    output_list = map(.x = beta_1, ~rerun(1000, sim_regression(beta1 = .x))),
  output_df = map(output_list, bind_rows)
  ) %>%
  unnest(output_df) %>%
  select(beta_1,beta1_hat,p_value) 
  
```

